<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#7B4B2A">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="–î–æ–ª–≥–∏">
    <meta name="color-scheme" content="light only">
    <meta name="format-detection" content="telephone=no">
    <title>–î–æ–ª–≥–∏</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <link rel="stylesheet" href="styles/global.css">
    <link rel="stylesheet" href="styles/debts.css">
</head>
<body>
    <header class="header">
        <button class="back-btn" onclick="window.history.back()">‚Üê –ù–∞–∑–∞–¥</button>
        <h1 class="page-title">–î–æ–ª–≥–∏</h1>
        <div class="header-space"></div>
    </header>

    <main class="debts-container">
        <div class="sort-container">
            <select class="sort-select" id="sort-select">
                <option value="date-desc">–ü–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)</option>
                <option value="date-asc">–ü–æ –¥–∞—Ç–µ (—Å—Ç–∞—Ä—ã–µ —Å–≤–µ—Ä—Ö—É)</option>
                <option value="amount-desc">–ü–æ —Å—É–º–º–µ (–±–æ–ª—å—à–µ —Å–≤–µ—Ä—Ö—É)</option>
                <option value="amount-asc">–ü–æ —Å—É–º–º–µ (–º–µ–Ω—å—à–µ —Å–≤–µ—Ä—Ö—É)</option>
                <option value="status">–ü–æ —Å—Ç–∞—Ç—É—Å—É</option>
            </select>
        </div>

        <div id="debts-list" class="debts-list">
            <div class="empty-state">
                <div class="empty-icon">üí∏</div>
                <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥–æ–ª–≥–æ–≤</p>
                <button class="btn btn-primary" onclick="debts.showCreateForm()">
                    –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ª–≥
                </button>
            </div>
        </div>

        <div id="debts-stats" class="stats-section">
            <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ–ª–≥–æ–≤</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-label">–í—Å–µ–≥–æ –¥–æ–ª–≥–æ–≤:</span>
                    <span class="stat-value" id="total-debts">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">–û–±—â–∞—è —Å—É–º–º–∞:</span>
                    <span class="stat-value" id="total-debt-amount">0 ‚ÇΩ</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">–ü–æ–≥–∞—à–µ–Ω–æ:</span>
                    <span class="stat-value" id="total-paid">0 ‚ÇΩ</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">–û—Å—Ç–∞–ª–æ—Å—å:</span>
                    <span class="stat-value" id="total-remaining">0 ‚ÇΩ</span>
                </div>
            </div>
        </div>
    </main>

    <button class="fab-button" id="fab-btn" aria-label="–î–æ–±–∞–≤–∏—Ç—å">+</button>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–ª–≥–∞ -->
    <div class="modal" id="debtModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="debt-modal-title">–ù–æ–≤—ã–π –¥–æ–ª–≥</h2>
                <button class="close-btn" onclick="debts.hideDebtForm()">&times;</button>
            </div>
            <form id="debtForm" class="debt-form">
                <input type="hidden" id="debtId" value="">
                
                <div class="form-group">
                    <label for="debtName">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                    <input type="text" id="debtName" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö—Ä–µ–¥–∏—Ç –Ω–∞ –º–∞—à–∏–Ω—É">
                </div>
                
                <div class="form-group">
                    <label for="debtAmount">–°—É–º–º–∞</label>
                    <input type="number" id="debtAmount" required placeholder="0" min="0">
                </div>
                
                <div class="form-group">
                    <label for="debtDate">–î–∞—Ç–∞</label>
                    <input type="date" id="debtDate" required>
                </div>
                
                <div class="form-group">
                    <label for="debtCategory">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select id="debtCategory">
                        <option value="">–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                        <option value="personal">–õ–∏—á–Ω—ã–µ</option>
                        <option value="bank">–ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ</option>
                        <option value="business">–ë–∏–∑–Ω–µ—Å</option>
                        <option value="other">–î—Ä—É–≥–æ–µ</option>
                        <option value="new">+ –ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="debtStatus">–°—Ç–∞—Ç—É—Å</label>
                    <select id="debtStatus">
                        <option value="active">–ê–∫—Ç–∏–≤–Ω—ã–π</option>
                        <option value="partial">–ß–∞—Å—Ç–∏—á–Ω–æ –ø–æ–≥–∞—à–µ–Ω</option>
                        <option value="closed">–ü–æ–≥–∞—à–µ–Ω</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="debtNote">–ó–∞–º–µ—Ç–∫–∞</label>
                    <textarea id="debtNote" rows="3" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="debts.hideDebtForm()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–ª–≥–∞ -->
    <div class="modal fullscreen" id="debtDetailModal">
        <div class="modal-content detail-content">
            <div class="detail-header">
                <button class="back-detail-btn" onclick="debts.hideDetail()">‚Üê –ù–∞–∑–∞–¥</button>
                <h2 id="detail-debt-title"></h2>
                <div class="detail-actions">
                    <button class="icon-btn" onclick="debts.exportDebt()" title="–°–∫–∞—á–∞—Ç—å">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                    </button>
                    <button class="icon-btn" onclick="debts.editCurrentDebt()" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                        </svg>
                    </button>
                    <button class="icon-btn delete" onclick="debts.deleteCurrentDebt()" title="–£–¥–∞–ª–∏—Ç—å">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        </svg>
                    </button>
                </div>
            </div>
            
            <div class="detail-info">
                <div class="info-item">
                    <span class="info-label">–°—É–º–º–∞:</span>
                    <span class="info-value amount" id="detail-debt-amount"></span>
                </div>
                <div class="info-item">
                    <span class="info-label">–î–∞—Ç–∞:</span>
                    <span class="info-value" id="detail-debt-date"></span>
                </div>
                <div class="info-item">
                    <span class="info-label">–°—Ç–∞—Ç—É—Å:</span>
                    <span class="info-value" id="detail-debt-status"></span>
                </div>
                <div class="info-item" id="detail-category-wrapper">
                    <span class="info-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</span>
                    <span class="info-value" id="detail-debt-category"></span>
                </div>
                <div class="info-item" id="detail-note-wrapper">
                    <span class="info-label">–ó–∞–º–µ—Ç–∫–∞:</span>
                    <span class="info-value" id="detail-debt-note"></span>
                </div>
            </div>
            
            <div class="progress-section">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div class="progress-text" id="progress-text">0%</div>
            </div>
            
            <div class="payments-section">
                <h3>–ü–æ–≥–∞—à–µ–Ω–∏—è</h3>
                <form id="paymentForm" class="payment-form">
                    <div class="payment-form-grid">
                        <input type="number" id="paymentAmount" placeholder="–°—É–º–º–∞" required min="0">
                        <input type="date" id="paymentDate" placeholder="–î–∞—Ç–∞">
                        <input type="text" id="paymentNote" placeholder="–ó–∞–º–µ—Ç–∫–∞">
                        <label class="checkbox">
                            <input type="checkbox" id="paymentPreliminary">
                            <span>–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ</span>
                        </label>
                        <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
                    </div>
                </form>
                
                <div id="payments-list" class="payments-list"></div>
            </div>
            
            <div class="detail-stats">
                <div class="stat-row">
                    <span>–î–æ–ª–≥:</span>
                    <span id="detail-debt">0 ‚ÇΩ</span>
                </div>
                <div class="stat-row">
                    <span>–ü–æ–≥–∞—à–µ–Ω–æ:</span>
                    <span id="detail-paid">0 ‚ÇΩ</span>
                </div>
                <div class="stat-row total">
                    <span>–û—Å—Ç–∞–ª–æ—Å—å:</span>
                    <span id="detail-remaining">0 ‚ÇΩ</span>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞ -->
    <div class="modal" id="paymentEditModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≥–∞—à–µ–Ω–∏–µ</h2>
                <button class="close-btn" onclick="debts.hidePaymentEditForm()">&times;</button>
            </div>
            <form id="paymentEditForm" class="payment-edit-form">
                <input type="hidden" id="editPaymentId" value="">
                
                <div class="form-group">
                    <label for="editPaymentAmount">–°—É–º–º–∞</label>
                    <input type="number" id="editPaymentAmount" required placeholder="0" min="0">
                </div>
                
                <div class="form-group">
                    <label for="editPaymentDate">–î–∞—Ç–∞</label>
                    <input type="date" id="editPaymentDate">
                </div>
                
                <div class="form-group">
                    <label for="editPaymentNote">–ó–∞–º–µ—Ç–∫–∞</label>
                    <input type="text" id="editPaymentNote" placeholder="–ó–∞–º–µ—Ç–∫–∞">
                </div>
                
                <div class="form-group checkbox-group" id="convertPaymentGroup">
                    <label class="checkbox">
                        <input type="checkbox" id="convertToRegular">
                        <span>–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤ –æ–±—ã—á–Ω–æ–µ –ø–æ–≥–∞—à–µ–Ω–∏–µ</span>
                    </label>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="debts.hidePaymentEditForm()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∞ -->
    <div class="modal" id="exportModal">
        <div class="modal-content export-content">
            <div class="modal-header">
                <h2>–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h2>
                <button class="close-btn" onclick="debts.hideExport()">&times;</button>
            </div>
            <textarea id="exportData" readonly></textarea>
            <div class="export-actions">
                <button class="btn btn-secondary" onclick="debts.copyExportData()">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                <button class="btn btn-primary" onclick="debts.downloadExportData()">–°–∫–∞—á–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
    <div class="modal" id="confirmModal">
        <div class="modal-content confirm-content">
            <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>
            <p id="confirmMessage"></p>
            <div class="confirm-actions">
                <button class="btn btn-secondary" onclick="debts.cancelAction()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary delete" onclick="debts.confirmAction()">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
    <div class="modal" id="categoryModal">
        <div class="modal-content category-content">
            <div class="modal-header">
                <h2>–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</h2>
                <button class="close-btn" onclick="debts.hideCategoryModal()">&times;</button>
            </div>
            <form id="categoryForm">
                <div class="form-group">
                    <label for="categoryName">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</label>
                    <input type="text" id="categoryName" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°–µ–º–µ–π–Ω—ã–µ">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="debts.hideCategoryModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>
    <script src="js/api.js"></script>
    <script src="js/debts.js"></script>
<script>
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ —Å–µ–∫—Ü–∏–∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤
function goBackToFinance() {
    const returnToSection = sessionStorage.getItem('returnToSection');
    
    if (returnToSection === 'finance') {
        window.location.href = 'index.html#finance';
    } else {
        window.history.back();
    }
}

// –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
document.addEventListener('DOMContentLoaded', function() {
    const backBtn = document.querySelector('.back-btn');
    if (backBtn) {
        backBtn.removeAttribute('onclick');
        backBtn.addEventListener('click', function(e) {
            e.preventDefault();
            goBackToFinance();
        });
    }
});
</script>
</body>
</html>
